--// GUI Script Full with Key System & Draggable Menu //--

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

-- KEY SYSTEM
local key1, key2, key3 = "abc", "abcd", "bacon premium"
local currentKey, lastSwitch = key1, os.time()
local keyDuration = 3600 -- 1 tiếng

-- Tạo GUI chính
local ScreenGui = Instance.new("ScreenGui", game.CoreGui)

-- Khung nhập Key
local KeyFrame = Instance.new("Frame", ScreenGui)
KeyFrame.Size = UDim2.new(0, 250, 0, 120)
KeyFrame.Position = UDim2.new(0.5, -125, 0.5, -60)
KeyFrame.BackgroundColor3 = Color3.fromRGB(30,30,30)
KeyFrame.Active = true
KeyFrame.Draggable = true

local KeyBox = Instance.new("TextBox", KeyFrame)
KeyBox.Size = UDim2.new(0, 200, 0, 30)
KeyBox.Position = UDim2.new(0.5, -100, 0.2, 0)
KeyBox.PlaceholderText = "Nhập Key..."
KeyBox.PlaceholderColor3 = Color3.fromRGB(180,180,180)
KeyBox.BackgroundColor3 = Color3.fromRGB(50,50,50)
KeyBox.TextColor3 = Color3.fromRGB(255,255,255)

local KeyBtn = Instance.new("TextButton", KeyFrame)
KeyBtn.Size = UDim2.new(0, 200, 0, 30)
KeyBtn.Position = UDim2.new(0.5, -100, 0.6, 0)
KeyBtn.BackgroundColor3 = Color3.fromRGB(70,70,70)
KeyBtn.TextColor3 = Color3.fromRGB(255,255,255)
KeyBtn.Text = "Xác Nhận"

local KeyMsg = Instance.new("TextLabel", KeyFrame)
KeyMsg.Size = UDim2.new(1,0,0,20)
KeyMsg.Position = UDim2.new(0,0,0.85,0)
KeyMsg.BackgroundTransparency = 1
KeyMsg.TextColor3 = Color3.fromRGB(255,0,0)
KeyMsg.Text = ""

-- Menu chính
local MainGui = Instance.new("Frame", ScreenGui)
MainGui.Size = UDim2.new(0, 400, 0, 300)
MainGui.Position = UDim2.new(0.5, -200, 0.5, -150)
MainGui.BackgroundColor3 = Color3.fromRGB(25,25,25)
MainGui.Active = true
MainGui.Draggable = true
MainGui.Visible = false

-- Nút đóng/mở menu chính
local ToggleBtn = Instance.new("TextButton", ScreenGui)
ToggleBtn.Size = UDim2.new(0, 80, 0, 30)
ToggleBtn.Position = UDim2.new(0,10,0,10)
ToggleBtn.BackgroundColor3 = Color3.fromRGB(50,50,50)
ToggleBtn.TextColor3 = Color3.fromRGB(255,255,255)
ToggleBtn.Text = "Menu"

ToggleBtn.MouseButton1Click:Connect(function()
    MainGui.Visible = not MainGui.Visible
end)

-- Tabs
local TabBar = Instance.new("Frame", MainGui)
TabBar.Size = UDim2.new(1,0,0,30)
TabBar.BackgroundColor3 = Color3.fromRGB(35,35,35)

local Content = Instance.new("Frame", MainGui)
Content.Size = UDim2.new(1,0,1,-30)
Content.Position = UDim2.new(0,0,0,30)
Content.BackgroundColor3 = Color3.fromRGB(25,25,25)

local function createTabButton(name, xPos)
    local btn = Instance.new("TextButton", TabBar)
    btn.Size = UDim2.new(0,100,1,0)
    btn.Position = UDim2.new(0, xPos, 0, 0)
    btn.Text = name
    btn.BackgroundColor3 = Color3.fromRGB(60,60,60)
    btn.TextColor3 = Color3.fromRGB(255,255,255)
    return btn
end

-- Tab buttons
local Tab1Btn = createTabButton("Tab1",0)
local Tab2Btn = createTabButton("Tab2",100)
local Tab3Btn = createTabButton("Tab3",200)

-- Tab contents
local Tab1 = Instance.new("Frame", Content)
Tab1.Size = UDim2.new(1,0,1,0)
Tab1.BackgroundTransparency = 1
Tab1.Visible = true

local Tab2 = Instance.new("Frame", Content)
Tab2.Size = UDim2.new(1,0,1,0)
Tab2.BackgroundTransparency = 1
Tab2.Visible = false

local Tab3 = Instance.new("Frame", Content)
Tab3.Size = UDim2.new(1,0,1,0)
Tab3.BackgroundTransparency = 1
Tab3.Visible = false

Tab1Btn.MouseButton1Click:Connect(function()
    Tab1.Visible, Tab2.Visible, Tab3.Visible = true,false,false
end)
Tab2Btn.MouseButton1Click:Connect(function()
    Tab1.Visible, Tab2.Visible, Tab3.Visible = false,true,false
end)
Tab3Btn.MouseButton1Click:Connect(function()
    Tab1.Visible, Tab2.Visible, Tab3.Visible = false,false,true
end)

-- Tab1: Toggles
local function createToggle(parent, text, yPos, callback)
    local btn = Instance.new("TextButton", parent)
    btn.Size = UDim2.new(0, 200, 0, 30)
    btn.Position = UDim2.new(0.1,0,0,yPos)
    btn.Text = text.." [OFF]"
    btn.BackgroundColor3 = Color3.fromRGB(70,70,70)
    btn.TextColor3 = Color3.fromRGB(255,255,255)
    local state = false
    btn.MouseButton1Click:Connect(function()
        state = not state
        btn.Text = text.." ["..(state and "ON" or "OFF").."]"
        callback(state)
    end)
end

createToggle(Tab1,"Fly",10,function(on) print("Fly:",on) end)
createToggle(Tab1,"Infinite Jump",50,function(on)
    if on then
        _G.infjump = true
        UserInputService.JumpRequest:Connect(function()
            if _G.infjump and LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid") then
                LocalPlayer.Character:FindFirstChildOfClass("Humanoid"):ChangeState("Jumping")
            end
        end)
    else
        _G.infjump = false
    end
end)
createToggle(Tab1,"Speed",90,function(on) print("Speed:",on) end)
createToggle(Tab1,"Noclip",130,function(on) print("Noclip:",on) end)
createToggle(Tab1,"ESP",170,function(on) print("ESP:",on) end)

-- Tab2: TP & script ngoài
local TpBtn = Instance.new("TextButton", Tab2)
TpBtn.Size = UDim2.new(0,200,0,30)
TpBtn.Position = UDim2.new(0.1,0,0,20)
TpBtn.Text = "TP đến người chơi gần nhất"
TpBtn.BackgroundColor3 = Color3.fromRGB(70,70,70)
TpBtn.TextColor3 = Color3.fromRGB(255,255,255)
TpBtn.MouseButton1Click:Connect(function()
    local closest,dist=nil,math.huge
    for _,p in pairs(Players:GetPlayers()) do
        if p~=LocalPlayer and p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
            local d=(p.Character.HumanoidRootPart.Position-LocalPlayer.Character.HumanoidRootPart.Position).magnitude
            if d<dist then dist=d closest=p end
        end
    end
    if closest then
        LocalPlayer.Character.HumanoidRootPart.CFrame=closest.Character.HumanoidRootPart.CFrame+Vector3.new(0,3,0)
    end
end)

local ScriptBtn = Instance.new("TextButton", Tab2)
ScriptBtn.Size = UDim2.new(0,200,0,30)
ScriptBtn.Position = UDim2.new(0.1,0,0,70)
ScriptBtn.Text = "Chạy Script Ngoài"
ScriptBtn.BackgroundColor3 = Color3.fromRGB(70,70,70)
ScriptBtn.TextColor3 = Color3.fromRGB(255,255,255)
ScriptBtn.MouseButton1Click:Connect(function()
    loadstring(game:HttpGet("https://raw.githubusercontent.com/LuaCrack/DatThg/refs/heads/main/DatThgV2"))()
end)

-- Tab3: Menu TP riêng
local CreateMenuBtn = Instance.new("TextButton", Tab3)
CreateMenuBtn.Size = UDim2.new(0,200,0,30)
CreateMenuBtn.Position = UDim2.new(0.1,0,0,20)
CreateMenuBtn.Text = "Tạo Menu TP"
CreateMenuBtn.BackgroundColor3 = Color3.fromRGB(70,70,70)
CreateMenuBtn.TextColor3 = Color3.fromRGB(255,255,255)

CreateMenuBtn.MouseButton1Click:Connect(function()
    local TPFrame = Instance.new("Frame", ScreenGui)
    TPFrame.Size = UDim2.new(0,200,0,120)
    TPFrame.Position = UDim2.new(0.3,0,0.3,0)
    TPFrame.BackgroundColor3 = Color3.fromRGB(40,40,40)
    TPFrame.Active = true
    TPFrame.Draggable = true

    local pos
    local SetBtn = Instance.new("TextButton", TPFrame)
    SetBtn.Size = UDim2.new(0,180,0,30)
    SetBtn.Position = UDim2.new(0.5,-90,0,10)
    SetBtn.Text = "Đặt Vị Trí"
    SetBtn.BackgroundColor3 = Color3.fromRGB(70,70,70)
    SetBtn.TextColor3 = Color3.fromRGB(255,255,255)
    SetBtn.MouseButton1Click:Connect(function()
        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
            pos = LocalPlayer.Character.HumanoidRootPart.CFrame
        end
    end)

    local TpBtn = Instance.new("TextButton", TPFrame)
    TpBtn.Size = UDim2.new(0,180,0,30)
    TpBtn.Position = UDim2.new(0.5,-90,0,50)
    TpBtn.Text = "TP Vị Trí"
    TpBtn.BackgroundColor3 = Color3.fromRGB(70,70,70)
    TpBtn.TextColor3 = Color3.fromRGB(255,255,255)
    TpBtn.MouseButton1Click:Connect(function()
        if pos and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
            LocalPlayer.Character.HumanoidRootPart.CFrame = pos
        end
    end)

    local CloseBtn = Instance.new("TextButton", TPFrame)
    CloseBtn.Size = UDim2.new(0,30,0,30)
    CloseBtn.Position = UDim2.new(1,-35,0,5)
    CloseBtn.Text = "X"
    CloseBtn.BackgroundColor3 = Color3.fromRGB(150,50,50)
    CloseBtn.TextColor3 = Color3.fromRGB(255,255,255)
    CloseBtn.MouseButton1Click:Connect(function() TPFrame:Destroy() end)
end)

-- Xử lý nhập Key
KeyBtn.MouseButton1Click:Connect(function()
    local input = string.lower(KeyBox.Text)
    local now = os.time()

    -- check key 3 (master)
    if input == string.lower(key3) then
        KeyFrame.Visible = false
        MainGui.Visible = true
        return
    end

    -- check key1 hoặc key2
    if input == string.lower(currentKey) then
        KeyFrame.Visible = false
        MainGui.Visible = true
        lastSwitch = now
    else
        KeyMsg.Text = "Key sai!"
    end
end)

-- Đổi key 1 ↔ 2 mỗi 1 tiếng
RunService.Stepped:Connect(function()
    if os.time() - lastSwitch >= keyDuration then
        if currentKey == key1 then
            currentKey = key2
        else
            currentKey = key1
        end
        lastSwitch = os.time()
    end
end)

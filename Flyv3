-- // Key System
local key1, key2, key3 = "abc", "abcd", "bacon premium"
local currentKey = key1
local lastSwitch = tick()
local switchInterval = 3600 -- 1 tiếng

-- Hàm đổi key
local function updateKey()
    if tick() - lastSwitch >= switchInterval then
        if currentKey == key1 then
            currentKey = key2
        else
            currentKey = key1
        end
        lastSwitch = tick()
    end
end

-- GUI Nhập Key
local ScreenGui = Instance.new("ScreenGui", game.CoreGui)
local KeyFrame = Instance.new("Frame", ScreenGui)
KeyFrame.Size = UDim2.new(0, 300, 0, 150)
KeyFrame.Position = UDim2.new(0.5, -150, 0.5, -75)
KeyFrame.BackgroundColor3 = Color3.fromRGB(30,30,30)
KeyFrame.Visible = true

local KeyBox = Instance.new("TextBox", KeyFrame)
KeyBox.Size = UDim2.new(0, 200, 0, 40)
KeyBox.Position = UDim2.new(0.5, -100, 0, 20)
KeyBox.PlaceholderText = "Nhập Key..."
KeyBox.Text = ""

local Submit = Instance.new("TextButton", KeyFrame)
Submit.Size = UDim2.new(0, 200, 0, 40)
Submit.Position = UDim2.new(0.5, -100, 0, 70)
Submit.Text = "Xác Nhận"

local CloseBtn = Instance.new("TextButton", KeyFrame)
CloseBtn.Size = UDim2.new(0, 40, 0, 40)
CloseBtn.Position = UDim2.new(1, -45, 0, 5)
CloseBtn.Text = "X"

local unlocked = false

CloseBtn.MouseButton1Click:Connect(function()
    KeyFrame.Visible = false
end)

Submit.MouseButton1Click:Connect(function()
    updateKey()
    if KeyBox.Text == currentKey or KeyBox.Text == key3 then
        unlocked = true
        KeyFrame:Destroy()
    else
        KeyBox.Text = ""
        KeyBox.PlaceholderText = "Sai Key!"
    end
end)

-- Chờ nhập key
repeat task.wait() until unlocked

-- // Menu chính
local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/xHeptc/Kavo-UI-Library/main/source.lua"))()
local Window = Library.CreateLib("Menu Chính", "DarkTheme")

-- Tab1
local Tab1 = Window:NewTab("Tab1")
local Section1 = Tab1:NewSection("Chức năng")

-- Fly
local flyEnabled = false
Section1:NewToggle("Fly", "Bật/Tắt bay", function(state)
    flyEnabled = state
    if flyEnabled then
        loadstring(game:HttpGet("https://pastebin.com/raw/YSL3xKYU"))()
    end
end)

-- Infinite Jump
local infJump = false
Section1:NewToggle("Infinite Jump", "Nhảy vô hạn", function(state)
    infJump = state
end)

game:GetService("UserInputService").JumpRequest:Connect(function()
    if infJump then
        game.Players.LocalPlayer.Character:FindFirstChildOfClass("Humanoid"):ChangeState("Jumping")
    end
end)

-- Speed
local speedEnabled = false
Section1:NewToggle("Speed", "Chạy nhanh", function(state)
    speedEnabled = state
    local hum = game.Players.LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
    if hum then
        hum.WalkSpeed = state and 100 or 16
    end
end)

-- Noclip
local noclip = false
Section1:NewToggle("Noclip", "Đi xuyên tường", function(state)
    noclip = state
end)

game:GetService("RunService").Stepped:Connect(function()
    if noclip then
        for _,v in pairs(game.Players.LocalPlayer.Character:GetDescendants()) do
            if v:IsA("BasePart") then
                v.CanCollide = false
            end
        end
    end
end)

-- ESP
local espEnabled = false
Section1:NewToggle("ESP", "Bật ESP", function(state)
    espEnabled = state
    if espEnabled then
        loadstring(game:HttpGet("https://raw.githubusercontent.com/zxciaz/Universal-ESP/main/esp.lua"))()
    end
end)

-- Tab2
local Tab2 = Window:NewTab("Tab2")
local Section2 = Tab2:NewSection("Script & TP")

-- TP tới người chơi
local Players = game:GetService("Players")
local dropdown
local tpTarget = nil
dropdown = Section2:NewDropdown("Chọn người chơi", "TP tới player", {}, function(name)
    tpTarget = name
    local lp = Players.LocalPlayer
    if lp and lp.Character and tpTarget then
        local target = Players:FindFirstChild(tpTarget)
        if target and target.Character and target.Character:FindFirstChild("HumanoidRootPart") then
            lp.Character:MoveTo(target.Character.HumanoidRootPart.Position + Vector3.new(0,5,0))
        end
    end
end)

local function refreshDropdown()
    local names = {}
    for _,p in pairs(Players:GetPlayers()) do
        if p ~= Players.LocalPlayer then
            table.insert(names, p.Name)
        end
    end
    dropdown:Refresh(names)
end

refreshDropdown()
Players.PlayerAdded:Connect(refreshDropdown)
Players.PlayerRemoving:Connect(refreshDropdown)

-- Script ngoài
Section2:NewButton("Script DatThgV2", "Chạy script", function()
    loadstring(game:HttpGet("https://raw.githubusercontent.com/LuaCrack/DatThg/refs/heads/main/DatThgV2"))()
end)

-- Tab3
local Tab3 = Window:NewTab("Tab3")
local Section3 = Tab3:NewSection("Menu riêng")

Section3:NewButton("Tạo Menu", "Tạo 1 menu riêng để TP vị trí", function()
    local miniGui = Instance.new("ScreenGui", game.CoreGui)
    local frame = Instance.new("Frame", miniGui)
    frame.Size = UDim2.new(0,200,0,120)
    frame.Position = UDim2.new(0.5,-100,0.5,-60)
    frame.BackgroundColor3 = Color3.fromRGB(40,40,40)

    local pos = nil

    local setBtn = Instance.new("TextButton", frame)
    setBtn.Size = UDim2.new(0,180,0,30)
    setBtn.Position = UDim2.new(0,10,0,10)
    setBtn.Text = "Đặt Vị Trí"

    local tpBtn = Instance.new("TextButton", frame)
    tpBtn.Size = UDim2.new(0,180,0,30)
    tpBtn.Position = UDim2.new(0,10,0,50)
    tpBtn.Text = "TP Vị Trí"

    local closeBtn = Instance.new("TextButton", frame)
    closeBtn.Size = UDim2.new(0,180,0,30)
    closeBtn.Position = UDim2.new(0,10,0,90)
    closeBtn.Text = "X"

    setBtn.MouseButton1Click:Connect(function()
        local hrp = game.Players.LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        if hrp then
            pos = hrp.Position
        end
    end)

    tpBtn.MouseButton1Click:Connect(function()
        if pos then
            game.Players.LocalPlayer.Character:MoveTo(pos)
        end
    end)

    closeBtn.MouseButton1Click:Connect(function()
        miniGui:Destroy()
    end)
end)

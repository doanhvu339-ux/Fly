--// Khởi tạo GUI chính
local ScreenGui = Instance.new("ScreenGui", game.CoreGui)

-- KEY SYSTEM
local Key1 = "abc"
local Key2 = "abcd"
local CurrentKey = Key1  -- mặc định luôn bắt đầu = abc

local KeyFrame = Instance.new("Frame", ScreenGui)
KeyFrame.Size = UDim2.new(0, 250, 0, 150)
KeyFrame.Position = UDim2.new(0.5, -125, 0.5, -75)
KeyFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)

local KeyBox = Instance.new("TextBox", KeyFrame)
KeyBox.Size = UDim2.new(0, 200, 0, 40)
KeyBox.Position = UDim2.new(0.5, -100, 0.3, 0)
KeyBox.PlaceholderText = "Nhập Key..."
KeyBox.Text = ""

local Submit = Instance.new("TextButton", KeyFrame)
Submit.Size = UDim2.new(0, 200, 0, 40)
Submit.Position = UDim2.new(0.5, -100, 0.65, 0)
Submit.Text = "Xác Nhận"

-- GUI chính (ẩn trước)
local MainGui = Instance.new("Frame")
MainGui.Size = UDim2.new(0, 350, 0, 400)
MainGui.Position = UDim2.new(0.5, -175, 0.5, -200)
MainGui.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
MainGui.Visible = false
MainGui.Active = true
MainGui.Draggable = true
MainGui.Parent = ScreenGui

-- Toggle Button
local ToggleButton = Instance.new("TextButton", ScreenGui)
ToggleButton.Size = UDim2.new(0, 100, 0, 30)
ToggleButton.Position = UDim2.new(0, 10, 0, 10)
ToggleButton.Text = "Menu"
ToggleButton.Visible = false
ToggleButton.MouseButton1Click:Connect(function()
    MainGui.Visible = not MainGui.Visible
end)

-- Tabs
local TabFolder = Instance.new("Folder", MainGui)
local Tab1 = Instance.new("Frame", TabFolder)
local Tab2 = Instance.new("Frame", TabFolder)
for _,tab in pairs({Tab1,Tab2}) do
    tab.Size = UDim2.new(1,0,1,0)
    tab.BackgroundTransparency = 1
    tab.Visible = false
end
Tab1.Visible = true

-- Nút chuyển tab
local Tab1Btn = Instance.new("TextButton", MainGui)
Tab1Btn.Size = UDim2.new(0,80,0,25)
Tab1Btn.Position = UDim2.new(0,10,0,10)
Tab1Btn.Text = "Tab 1"
Tab1Btn.MouseButton1Click:Connect(function()
    Tab1.Visible = true
    Tab2.Visible = false
end)

local Tab2Btn = Instance.new("TextButton", MainGui)
Tab2Btn.Size = UDim2.new(0,80,0,25)
Tab2Btn.Position = UDim2.new(0,100,0,10)
Tab2Btn.Text = "Tab 2"
Tab2Btn.MouseButton1Click:Connect(function()
    Tab1.Visible = false
    Tab2.Visible = true
end)

-- Hàm tạo nút
local function createButton(parent, text, pos, callback)
    local btn = Instance.new("TextButton", parent)
    btn.Size = UDim2.new(0,200,0,30)
    btn.Position = UDim2.new(0,75,0,pos)
    btn.Text = text
    btn.MouseButton1Click:Connect(callback)
end

-- ========== TAB 1 ==========
createButton(Tab1,"FlyGui",50,function()
    loadstring(game:HttpGet("https://raw.githubusercontent.com/XNEOFF/FlyGuiV3/main/FlyGuiV3.txt"))()
end)

createButton(Tab1,"Infinite Jump",90,function()
    local UserInputService = game:GetService("UserInputService")
    UserInputService.JumpRequest:Connect(function()
        game.Players.LocalPlayer.Character:FindFirstChildOfClass("Humanoid"):ChangeState("Jumping")
    end)
end)

createButton(Tab1,"Speed",130,function()
    game.Players.LocalPlayer.Character.Humanoid.WalkSpeed = 100
end)

createButton(Tab1,"Noclip",170,function()
    local noclip = true
    game:GetService("RunService").Stepped:Connect(function()
        if noclip then
            for _,v in pairs(game.Players.LocalPlayer.Character:GetDescendants()) do
                if v:IsA("BasePart") then
                    v.CanCollide = false
                end
            end
        end
    end)
end)

createButton(Tab1,"ESP Toggle",210,function()
    local enabled = not _G.ESP
    _G.ESP = enabled
    if enabled then
        for _,plr in pairs(game.Players:GetPlayers()) do
            if plr ~= game.Players.LocalPlayer and plr.Character and plr.Character:FindFirstChild("Head") then
                if not plr.Character.Head:FindFirstChild("ESP") then
                    local billboard = Instance.new("BillboardGui", plr.Character.Head)
                    billboard.Name = "ESP"
                    billboard.Size = UDim2.new(0,200,0,50)
                    billboard.AlwaysOnTop = true
                    local label = Instance.new("TextLabel", billboard)
                    label.Size = UDim2.new(1,0,1,0)
                    label.Text = plr.Name
                    label.TextColor3 = Color3.new(1,0,0)
                    label.BackgroundTransparency = 1
                end
            end
        end
    else
        for _,plr in pairs(game.Players:GetPlayers()) do
            if plr.Character and plr.Character:FindFirstChild("Head") and plr.Character.Head:FindFirstChild("ESP") then
                plr.Character.Head.ESP:Destroy()
            end
        end
    end
end)

-- ========== TAB 2 ==========
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

-- Dropdown Frame
local DropFrame = Instance.new("Frame", Tab2)
DropFrame.Size = UDim2.new(0,200,0,150)
DropFrame.Position = UDim2.new(0,75,0,50)
DropFrame.BackgroundColor3 = Color3.fromRGB(50,50,50)

local Title = Instance.new("TextLabel", DropFrame)
Title.Size = UDim2.new(1,0,0,30)
Title.Text = "Chọn người chơi"
Title.TextColor3 = Color3.new(1,1,1)
Title.BackgroundTransparency = 1

local PlayerList = Instance.new("ScrollingFrame", DropFrame)
PlayerList.Size = UDim2.new(1,0,1,-30)
PlayerList.Position = UDim2.new(0,0,0,30)
PlayerList.CanvasSize = UDim2.new(0,0,0,0)
PlayerList.ScrollBarThickness = 6

local function refreshList()
    PlayerList:ClearAllChildren()
    local y = 0
    for _,plr in pairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer then
            local btn = Instance.new("TextButton", PlayerList)
            btn.Size = UDim2.new(1,0,0,25)
            btn.Position = UDim2.new(0,0,0,y)
            btn.Text = plr.Name
            btn.MouseButton1Click:Connect(function()
                if plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
                    LocalPlayer.Character.HumanoidRootPart.CFrame =
                        plr.Character.HumanoidRootPart.CFrame + Vector3.new(0,5,0)
                end
            end)
            y = y + 25
        end
    end
    PlayerList.CanvasSize = UDim2.new(0,0,0,y)
end

Players.PlayerAdded:Connect(refreshList)
Players.PlayerRemoving:Connect(refreshList)
refreshList()

-- XỬ LÝ NHẬP KEY
Submit.MouseButton1Click:Connect(function()
    if KeyBox.Text == CurrentKey then
        KeyFrame.Visible = false
        ToggleButton.Visible = true
        -- đổi key cho lần sau
        if CurrentKey == Key1 then
            CurrentKey = Key2
        else
            CurrentKey = Key1
        end
    else
        KeyBox.Text = ""
        KeyBox.PlaceholderText = "Sai Key!"
    end
end)

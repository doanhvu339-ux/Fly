--// Key + Menu Script Full (By ChatGPT Custom)
-- Yêu cầu executor hỗ trợ writefile/readfile (Synapse, Script-Ware, Wave...)

-- Services
local Players = game:GetService("Players")
local UIS = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer

-- File lưu settings
local settingsFile = "my_menu_settings.json"
local HttpService = game:GetService("HttpService")

-- Load / Save settings
local settings = {
    infjump = false,
    noclip = false,
    walkspeed = false,
    walkspeedValue = 16,
    hitboxAll = false,
    hitboxEnemy = false,
    hitboxSize = 7,
    espAll = false,
    espEnemy = false
}

local function saveSettings()
    writefile(settingsFile, HttpService:JSONEncode(settings))
end

local function loadSettings()
    if isfile(settingsFile) then
        local ok, data = pcall(function()
            return HttpService:JSONDecode(readfile(settingsFile))
        end)
        if ok and type(data) == "table" then
            for k,v in pairs(data) do
                settings[k] = v
            end
        end
    end
end
loadSettings()

-- Key system
local validKeys = {
    ["1"] = true,
    ["09"] = true,
    ["bpremium"] = true
}
local function checkKey(k) return validKeys[k] ~= nil end

-- UI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = game.CoreGui

-- Bảng nhập key
local KeyFrame = Instance.new("Frame", ScreenGui)
KeyFrame.Size = UDim2.new(0, 250, 0, 150)
KeyFrame.Position = UDim2.new(0.5, -125, 0.5, -75)
KeyFrame.BackgroundColor3 = Color3.fromRGB(40,40,40)

local KeyBox = Instance.new("TextBox", KeyFrame)
KeyBox.Size = UDim2.new(1,-20,0,30)
KeyBox.Position = UDim2.new(0,10,0,20)
KeyBox.PlaceholderText = "Nhập key..."

local KeyBtn = Instance.new("TextButton", KeyFrame)
KeyBtn.Size = UDim2.new(1,-20,0,30)
KeyBtn.Position = UDim2.new(0,10,0,70)
KeyBtn.Text = "Submit"

local KeyMsg = Instance.new("TextLabel", KeyFrame)
KeyMsg.Size = UDim2.new(1,0,0,20)
KeyMsg.Position = UDim2.new(0,0,0,110)
KeyMsg.TextColor3 = Color3.new(1,0,0)
KeyMsg.Text = ""

-- Main menu button
local MainBtn = Instance.new("TextButton", ScreenGui)
MainBtn.Size = UDim2.new(0,80,0,30)
MainBtn.Position = UDim2.new(1,-90,0,10)
MainBtn.Text = "Main"
MainBtn.Visible = false

-- Main frame
local MainFrame = Instance.new("Frame", ScreenGui)
MainFrame.Size = UDim2.new(0, 400, 0, 300)
MainFrame.Position = UDim2.new(0.5,-200,0.5,-150)
MainFrame.BackgroundColor3 = Color3.fromRGB(50,50,50)
MainFrame.Visible = false

local tabButtons = Instance.new("Frame", MainFrame)
tabButtons.Size = UDim2.new(1,0,0,30)
tabButtons.BackgroundColor3 = Color3.fromRGB(70,70,70)

local content = Instance.new("Frame", MainFrame)
content.Size = UDim2.new(1,0,1,-30)
content.Position = UDim2.new(0,0,0,30)
content.BackgroundColor3 = Color3.fromRGB(30,30,30)

-- Tab system
local function clearContent()
    for _,v in pairs(content:GetChildren()) do v:Destroy() end
end

-- PLAYER TAB
local function playerTab()
    clearContent()
    local y=10

    -- InfJump
    local infBtn=Instance.new("TextButton",content)
    infBtn.Size=UDim2.new(1,-20,0,30)
    infBtn.Position=UDim2.new(0,10,0,y)
    infBtn.Text="InfJump: "..tostring(settings.infjump)
    infBtn.MouseButton1Click:Connect(function()
        settings.infjump = not settings.infjump
        infBtn.Text="InfJump: "..tostring(settings.infjump)
        saveSettings()
    end)
    y=y+40

    -- Noclip
    local noclipBtn=Instance.new("TextButton",content)
    noclipBtn.Size=UDim2.new(1,-20,0,30)
    noclipBtn.Position=UDim2.new(0,10,0,y)
    noclipBtn.Text="Noclip: "..tostring(settings.noclip)
    noclipBtn.MouseButton1Click:Connect(function()
        settings.noclip = not settings.noclip
        noclipBtn.Text="Noclip: "..tostring(settings.noclip)
        saveSettings()
    end)
    y=y+40

    -- Walkspeed toggle
    local wsBtn=Instance.new("TextButton",content)
    wsBtn.Size=UDim2.new(1,-20,0,30)
    wsBtn.Position=UDim2.new(0,10,0,y)
    wsBtn.Text="WalkSpeed: "..tostring(settings.walkspeed)
    wsBtn.MouseButton1Click:Connect(function()
        settings.walkspeed = not settings.walkspeed
        wsBtn.Text="WalkSpeed: "..tostring(settings.walkspeed)
        saveSettings()
    end)
    y=y+40

    -- Walkspeed box
    local wsBox=Instance.new("TextBox",content)
    wsBox.Size=UDim2.new(1,-20,0,30)
    wsBox.Position=UDim2.new(0,10,0,y)
    wsBox.Text=tostring(settings.walkspeedValue or 16)
    wsBox.FocusLost:Connect(function()
        local v=tonumber(wsBox.Text)
        if v then
            settings.walkspeedValue=v
            saveSettings()
        end
    end)
    y=y+40

    -- Player TP List
    local tpBtn=Instance.new("TextButton",content)
    tpBtn.Size=UDim2.new(1,-20,0,30)
    tpBtn.Position=UDim2.new(0,10,0,y)
    tpBtn.Text="Mở Player TP"
    tpBtn.MouseButton1Click:Connect(function()
        local tpFrame=Instance.new("Frame",ScreenGui)
        tpFrame.Size=UDim2.new(0,200,0,300)
        tpFrame.Position=UDim2.new(0,100,0.5,-150)
        tpFrame.BackgroundColor3=Color3.fromRGB(60,60,60)
        local list=Instance.new("UIListLayout",tpFrame)

        local close=Instance.new("TextButton",tpFrame)
        close.Size=UDim2.new(1,0,0,30)
        close.Text="Close"
        close.MouseButton1Click:Connect(function() tpFrame:Destroy() end)

        local function refresh()
            for _,b in pairs(tpFrame:GetChildren()) do
                if b:IsA("TextButton") and b~=close then b:Destroy() end
            end
            for _,plr in pairs(Players:GetPlayers()) do
                if plr~=LocalPlayer then
                    local btn=Instance.new("TextButton",tpFrame)
                    btn.Size=UDim2.new(1,0,0,30)
                    btn.Text=plr.Name
                    btn.MouseButton1Click:Connect(function()
                        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
                            LocalPlayer.Character:MoveTo(plr.Character.HumanoidRootPart.Position + Vector3.new(0,3,0))
                        end
                    end)
                end
            end
        end
        refresh()
        Players.PlayerAdded:Connect(refresh)
        Players.PlayerRemoving:Connect(refresh)
    end)
end

-- ESP TAB
local function espTab()
    clearContent()
    local y=10

    local hbBox=Instance.new("TextBox",content)
    hbBox.Size=UDim2.new(1,-20,0,30)
    hbBox.Position=UDim2.new(0,10,0,y)
    hbBox.Text=tostring(settings.hitboxSize or 7)
    hbBox.FocusLost:Connect(function()
        local n=tonumber(hbBox.Text)
        if n then settings.hitboxSize=n saveSettings() end
    end)
    y=y+40

    local hitAll=Instance.new("TextButton",content)
    hitAll.Size=UDim2.new(1,-20,0,30)
    hitAll.Position=UDim2.new(0,10,0,y)
    hitAll.Text="Hitbox All: "..tostring(settings.hitboxAll)
    hitAll.MouseButton1Click:Connect(function()
        settings.hitboxAll=not settings.hitboxAll
        hitAll.Text="Hitbox All: "..tostring(settings.hitboxAll)
        saveSettings()
    end)
    y=y+40

    local hitEnemy=Instance.new("TextButton",content)
    hitEnemy.Size=UDim2.new(1,-20,0,30)
    hitEnemy.Position=UDim2.new(0,10,0,y)
    hitEnemy.Text="Hitbox Enemy: "..tostring(settings.hitboxEnemy)
    hitEnemy.MouseButton1Click:Connect(function()
        settings.hitboxEnemy=not settings.hitboxEnemy
        hitEnemy.Text="Hitbox Enemy: "..tostring(settings.hitboxEnemy)
        saveSettings()
    end)
    y=y+40

    local espAll=Instance.new("TextButton",content)
    espAll.Size=UDim2.new(1,-20,0,30)
    espAll.Position=UDim2.new(0,10,0,y)
    espAll.Text="ESP All: "..tostring(settings.espAll)
    espAll.MouseButton1Click:Connect(function()
        settings.espAll=not settings.espAll
        espAll.Text="ESP All: "..tostring(settings.espAll)
        saveSettings()
    end)
    y=y+40

    local espEnemy=Instance.new("TextButton",content)
    espEnemy.Size=UDim2.new(1,-20,0,30)
    espEnemy.Position=UDim2.new(0,10,0,y)
    espEnemy.Text="ESP Enemy: "..tostring(settings.espEnemy)
    espEnemy.MouseButton1Click:Connect(function()
        settings.espEnemy=not settings.espEnemy
        espEnemy.Text="ESP Enemy: "..tostring(settings.espEnemy)
        saveSettings()
    end)
end

-- SCRIPT TAB
local function scriptTab()
    clearContent()
    local y=10

    local fly=Instance.new("TextButton",content)
    fly.Size=UDim2.new(1,-20,0,30)
    fly.Position=UDim2.new(0,10,0,y)
    fly.Text="FlyGuiV3"
    fly.MouseButton1Click:Connect(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/XNEOFF/FlyGuiV3/main/FlyGuiV3.txt"))()
    end)
    y=y+40

    local dat=Instance.new("TextButton",content)
    dat.Size=UDim2.new(1,-20,0,30)
    dat.Position=UDim2.new(0,10,0,y)
    dat.Text="DatTh Script"
    dat.MouseButton1Click:Connect(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/LuaCrack/DatThg/refs/heads/main/DatThgV2"))()
    end)
    y=y+40

    local tp=Instance.new("TextButton",content)
    tp.Size=UDim2.new(1,-20,0,30)
    tp.Position=UDim2.new(0,10,0,y)
    tp.Text="Menu TP"
    tp.MouseButton1Click:Connect(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/doanhvu339-ux/Fly/refs/heads/main/scripttp"))()
    end)
    y=y+40

    local floatBtn=Instance.new("TextButton",content)
    floatBtn.Size=UDim2.new(1,-20,0,30)
    floatBtn.Position=UDim2.new(0,10,0,y)
    floatBtn.Text="Float"
    floatBtn.MouseButton1Click:Connect(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/doanhvu339-ux/Fly/refs/heads/main/Float"))()
    end)
end

-- Tab buttons
local function makeTab(name,func,xpos)
    local b=Instance.new("TextButton",tabButtons)
    b.Size=UDim2.new(0,100,1,0)
    b.Position=UDim2.new(0,xpos,0,0)
    b.Text=name
    b.MouseButton1Click:Connect(func)
end
makeTab("Player",playerTab,0)
makeTab("ESP",espTab,100)
makeTab("Script",scriptTab,200)

-- Toggle MainFrame
MainBtn.MouseButton1Click:Connect(function()
    MainFrame.Visible = not MainFrame.Visible
end)

-- Key check
KeyBtn.MouseButton1Click:Connect(function()
    local k=KeyBox.Text
    if checkKey(k) then
        KeyFrame.Visible=false
        MainBtn.Visible=true
    else
        KeyMsg.Text="Key không hợp lệ"
    end
end)

-- Features Loops
-- InfJump
local function bindInfJump()
    UIS.JumpRequest:Connect(function()
        if settings.infjump and LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid") then
            LocalPlayer.Character:FindFirstChildOfClass("Humanoid"):ChangeState("Jumping")
        end
    end)
end
LocalPlayer.CharacterAdded:Connect(function()
    task.wait(1)
    bindInfJump()
end)
bindInfJump()

-- Noclip
game:GetService("RunService").Stepped:Connect(function()
    if settings.noclip and LocalPlayer.Character then
        for _,v in pairs(LocalPlayer.Character:GetDescendants()) do
            if v:IsA("BasePart") and v.CanCollide then
                v.CanCollide=false
            end
        end
    end
end)

-- Walkspeed
task.spawn(function()
    while task.wait(0.5) do
        if settings.walkspeed and LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid") then
            LocalPlayer.Character:FindFirstChildOfClass("Humanoid").WalkSpeed=settings.walkspeedValue
        elseif LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid") then
            LocalPlayer.Character:FindFirstChildOfClass("Humanoid").WalkSpeed=16
        end
    end
end)

-- Hitbox
local defaultSize=Vector3.new(2,2,1)
task.spawn(function()
    while task.wait(0.5) do
        for _,plr in pairs(Players:GetPlayers()) do
            if plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
                local root=plr.Character.HumanoidRootPart
                if settings.hitboxAll then
                    root.Size=Vector3.new(settings.hitboxSize,settings.hitboxSize,settings.hitboxSize)
                    root.Transparency=0.7
                    root.BrickColor=BrickColor.new("Lime green")
                    root.Material=Enum.Material.Neon
                    root.CanCollide=false
                elseif settings.hitboxEnemy and plr.Team~=LocalPlayer.Team then
                    root.Size=Vector3.new(settings.hitboxSize,settings.hitboxSize,settings.hitboxSize)
                    root.Transparency=0.7
                    root.BrickColor=BrickColor.new("Lime green")
                    root.Material=Enum.Material.Neon
                    root.CanCollide=false
                else
                    root.Size=defaultSize
                    root.Transparency=1
                    root.Material=Enum.Material.Plastic
                end
            end
        end
    end
end)

-- ESP
task.spawn(function()
    while task.wait(1) do
        for _,plr in pairs(Players:GetPlayers()) do
            if plr~=LocalPlayer and plr.Character then
                local char=plr.Character
                local hl=char:FindFirstChild("ESP_Highlight")
                local show=false
                if settings.espAll then show=true end
                if settings.espEnemy and plr.Team~=LocalPlayer.Team then show=true end
                if show then
                    if not hl then
                        hl=Instance.new("Highlight")
                        hl.Name="ESP_Highlight"
                        hl.FillTransparency=1
                        hl.OutlineColor=Color3.fromRGB(0,255,0)
                        hl.Parent=char
                    end
                else
                    if hl then hl:Destroy() end
                end
            end
        end
    end
end)
